<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PH Lotto Analytics Dashboard</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel Standalone -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .animate-pulse-soft { animation: pulse-soft 2s infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // Simplified Lucide Icon Component for Browser
        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                Trophy: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
                BarChart3: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>,
                Sparkles: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>,
                History: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>,
                ChevronRight: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m9 18 6-6-6-6"/></svg>,
                RefreshCcw: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>,
                TrendingUp: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
                AlertCircle: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
                Calendar: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
                Loader: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`animate-spin ${className}`}><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></svg>
            };
            return icons[name] || null;
        };

        const LOTTO_GAMES = {
          '6/58': { name: 'Ultra Lotto', max: 58, color: 'bg-blue-600', drawDays: 'Tue, Fri, Sun' },
          '6/55': { name: 'Grand Lotto', max: 55, color: 'bg-yellow-600', drawDays: 'Mon, Wed, Sat' },
          '6/49': { name: 'Super Lotto', max: 49, color: 'bg-red-600', drawDays: 'Tue, Thu, Sun' },
          '6/45': { name: 'Mega Lotto', max: 45, color: 'bg-purple-600', drawDays: 'Mon, Wed, Fri' },
          '6/42': { name: 'Lotto', max: 42, color: 'bg-green-600', drawDays: 'Tue, Thu, Sat' }
        };

        const App = () => {
          const [activeTab, setActiveTab] = useState('frequency');
          const [selectedGame, setSelectedGame] = useState('6/58');
          const [prediction, setPrediction] = useState([]);
          const [lottoData, setLottoData] = useState([]);
          const [isLoading, setIsLoading] = useState(true);
          const [error, setError] = useState(null);

          // Robust Data Fetching with fallback sources
          const fetchData = async () => {
            setIsLoading(true);
            setError(null);
            
            // List of potential community-maintained endpoints
            const sources = [
                'https://raw.githubusercontent.com/ArunMichaelDsouza/ph-lotto-results/main/data.json',
                'https://raw.githubusercontent.com/fayasansari/ph-lotto-results/main/lotto_results.json'
            ];

            let success = false;
            for (const url of sources) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) continue;
                    
                    const rawData = await response.json();
                    
                    // Flexible normalization to handle different JSON structures
                    const formatted = (Array.isArray(rawData) ? rawData : rawData.results || []).map(item => {
                        const gameName = item.game || item.name || "";
                        const numbers = item.combination ? item.combination.split('-').map(Number) : 
                                       (Array.isArray(item.numbers) ? item.numbers : []);
                        
                        return {
                            game: gameName.replace('Lotto ', ''),
                            date: item.date,
                            numbers: numbers,
                            jackpot: item.jackpot || "N/A"
                        };
                    }).filter(item => item.numbers.length > 0);
                    
                    if (formatted.length > 0) {
                        setLottoData(formatted);
                        success = true;
                        break;
                    }
                } catch (err) {
                    console.warn(`Failed to fetch from ${url}:`, err);
                }
            }

            if (!success) {
                setError("Unable to sync live results. The community data source might be temporarily offline.");
            }
            setIsLoading(false);
          };

          useEffect(() => {
            fetchData();
          }, []);

          const stats = useMemo(() => {
            const config = LOTTO_GAMES[selectedGame];
            const freqMap = {};
            for (let i = 1; i <= config.max; i++) freqMap[i] = 0;

            const gameHistory = lottoData.filter(h => h.game.includes(selectedGame));
            
            gameHistory.forEach(draw => {
              draw.numbers.forEach(num => {
                if (freqMap[num] !== undefined) freqMap[num]++;
              });
            });

            const entries = Object.entries(freqMap).map(([num, count]) => ({
              number: parseInt(num),
              count: count,
              percentage: gameHistory.length > 0 ? ((count / gameHistory.length) * 100).toFixed(1) : 0
            }));

            const sortedByCount = [...entries].sort((a, b) => b.count - a.count);

            return {
              all: entries.sort((a, b) => a.number - b.number),
              hot: sortedByCount.slice(0, 6),
              cold: sortedByCount.reverse().slice(0, 6),
              totalDraws: gameHistory.length
            };
          }, [selectedGame, lottoData]);

          const generatePrediction = () => {
            const config = LOTTO_GAMES[selectedGame];
            const hotNums = stats.hot.map(n => n.number);
            const allNums = Array.from({ length: config.max }, (_, i) => i + 1);
            const selected = new Set();
            
            if (hotNums.length >= 3) {
                while (selected.size < 3) {
                    selected.add(hotNums[Math.floor(Math.random() * hotNums.length)]);
                }
            }
            
            while (selected.size < 6) {
              const rand = allNums[Math.floor(Math.random() * allNums.length)];
              selected.add(rand);
            }
            setPrediction(Array.from(selected).sort((a, b) => a - b));
          };

          useEffect(() => {
            if (!isLoading) generatePrediction();
          }, [selectedGame, isLoading, lottoData]);

          if (isLoading) {
            return (
              <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50">
                <Icon name="Loader" size={48} className="text-blue-600 mb-4" />
                <p className="text-slate-600 font-medium animate-pulse-soft">Connecting to PCSO data sources...</p>
              </div>
            );
          }

          if (error) {
            return (
              <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 p-4">
                <div className="bg-white p-8 rounded-2xl shadow-xl border border-red-100 text-center max-w-sm">
                  <Icon name="AlertCircle" size={48} className="text-red-500 mx-auto mb-4" />
                  <h2 className="text-xl font-bold mb-2">Sync Error</h2>
                  <p className="text-slate-500 mb-6 text-sm leading-relaxed">{error}</p>
                  <button 
                    onClick={fetchData}
                    className="w-full bg-slate-900 text-white py-3 rounded-xl font-bold hover:bg-slate-800 transition-all flex items-center justify-center gap-2"
                  >
                    <Icon name="RefreshCcw" size={18} /> Retry Connection
                  </button>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-slate-50 text-slate-900 font-sans">
              <header className="bg-white border-b sticky top-0 z-10 shadow-sm">
                <div className="max-w-5xl mx-auto px-4 py-4 flex flex-col md:flex-row md:items-center justify-between gap-4">
                  <div className="flex items-center gap-2">
                    <div className="bg-blue-600 p-2 rounded-lg">
                      <Icon name="Trophy" className="text-white" size={24} />
                    </div>
                    <div>
                        <h1 className="text-xl font-bold tracking-tight">PH Lotto <span className="text-blue-600">Analytics</span></h1>
                        <div className="flex items-center gap-1 text-[10px] text-green-600 font-bold uppercase tracking-wider">
                            <span className="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span> Network Status: Active
                        </div>
                    </div>
                  </div>
                  <div className="flex gap-2 overflow-x-auto pb-1 md:pb-0 scrollbar-hide">
                    {Object.keys(LOTTO_GAMES).map((code) => (
                      <button
                        key={code}
                        onClick={() => setSelectedGame(code)}
                        className={`px-3 py-1.5 rounded-full text-sm font-medium transition-all whitespace-nowrap ${
                          selectedGame === code 
                          ? 'bg-slate-900 text-white shadow-md' 
                          : 'bg-white text-slate-600 border hover:bg-slate-100'
                        }`}
                      >
                        {code}
                      </button>
                    ))}
                  </div>
                </div>
              </header>

              <main className="max-w-5xl mx-auto px-4 py-6">
                <div className="mb-8 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                  <div>
                    <h2 className="text-2xl font-bold">{LOTTO_GAMES[selectedGame].name}</h2>
                    <p className="text-slate-500 text-sm">Analyzing {stats.totalDraws} recorded draws</p>
                  </div>
                  <div className="text-right bg-blue-50 px-4 py-2 rounded-xl border border-blue-100">
                    <div className="text-[10px] font-bold text-blue-400 uppercase tracking-widest">Draw Schedule</div>
                    <div className="flex items-center justify-end gap-1 text-blue-700 font-bold text-sm">
                      <Icon name="Calendar" size={14} /> {LOTTO_GAMES[selectedGame].drawDays}
                    </div>
                  </div>
                </div>

                <div className="flex bg-slate-200/50 p-1 rounded-xl mb-6 w-fit overflow-x-auto max-w-full">
                  <button onClick={() => setActiveTab('frequency')} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap ${activeTab === 'frequency' ? 'bg-white shadow-sm text-blue-600' : 'text-slate-600'}`}>
                    <Icon name="BarChart3" size={18} /> Frequency
                  </button>
                  <button onClick={() => setActiveTab('prediction')} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap ${activeTab === 'prediction' ? 'bg-white shadow-sm text-blue-600' : 'text-slate-600'}`}>
                    <Icon name="Sparkles" size={18} /> Smart Predictor
                  </button>
                  <button onClick={() => setActiveTab('history')} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap ${activeTab === 'history' ? 'bg-white shadow-sm text-blue-600' : 'text-slate-600'}`}>
                    <Icon name="History" size={18} /> Draw History
                  </button>
                </div>

                <div className="space-y-6">
                  {activeTab === 'frequency' && (
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                      <div className="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <div className="flex items-center justify-between mb-6">
                          <h3 className="font-bold text-lg flex items-center gap-2">
                            <Icon name="TrendingUp" size={20} className="text-blue-500" /> Probability Heat Map
                          </h3>
                        </div>
                        <div className="grid grid-cols-5 sm:grid-cols-7 md:grid-cols-10 gap-2">
                          {stats.all.map((item) => {
                            const maxCount = Math.max(...stats.all.map(i => i.count));
                            const intensity = maxCount > 0 ? item.count / maxCount : 0;
                            const opacity = 0.05 + (intensity * 0.9);
                            return (
                              <div key={item.number} className="group relative flex flex-col items-center p-2 rounded-lg border border-slate-50 transition-all hover:ring-2 hover:ring-blue-400 cursor-help" style={{ backgroundColor: `rgba(37, 99, 235, ${opacity})` }}>
                                <span className={`text-sm font-bold ${opacity > 0.5 ? 'text-white' : 'text-slate-700'}`}>{item.number}</span>
                                <div className="absolute bottom-full mb-2 hidden group-hover:block z-20">
                                  <div className="bg-slate-900 text-white text-[10px] px-2 py-1 rounded shadow-xl whitespace-nowrap">{item.count} hits ({item.percentage}%)</div>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>

                      <div className="space-y-4">
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                          <h4 className="text-blue-600 font-bold mb-4 flex items-center gap-2">
                            <Icon name="TrendingUp" size={16} /> Hot Picks (Frequent)
                          </h4>
                          <div className="space-y-3">
                            {stats.hot.map((item, idx) => (
                              <div key={idx} className="flex items-center justify-between p-2 bg-blue-50/50 rounded-lg">
                                <div className="flex items-center gap-3">
                                  <div className="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-sm">{item.number}</div>
                                  <span className="text-xs text-slate-500">Frequency: {item.percentage}%</span>
                                </div>
                                <span className="font-bold text-blue-700">{item.count}</span>
                              </div>
                            ))}
                          </div>
                        </div>
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                          <h4 className="text-amber-600 font-bold mb-4 flex items-center gap-2">
                            <Icon name="AlertCircle" size={16} /> Cold Picks (Overdue)
                          </h4>
                          <div className="space-y-3">
                            {stats.cold.map((item, idx) => (
                              <div key={idx} className="flex items-center justify-between p-2 bg-amber-50/50 rounded-lg">
                                <div className="flex items-center gap-3">
                                  <div className="w-8 h-8 rounded-full bg-amber-500 flex items-center justify-center text-white font-bold text-sm">{item.number}</div>
                                  <span className="text-xs text-slate-500">Least frequent</span>
                                </div>
                                <span className="font-bold text-amber-700">{item.count}</span>
                              </div>
                            ))}
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  {activeTab === 'prediction' && (
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                      <div className="p-8 text-center bg-gradient-to-br from-blue-600 to-indigo-700 text-white">
                        <div className="inline-block p-3 bg-white/20 rounded-full mb-4">
                          <Icon name="Sparkles" size={32} />
                        </div>
                        <h3 className="text-2xl font-bold mb-2">Smart Prediction Engine</h3>
                        <p className="text-blue-100 max-w-md mx-auto">Balanced algorithm using frequency analysis of {stats.totalDraws} draws.</p>
                      </div>
                      <div className="p-8 flex flex-col items-center">
                        <div className="flex flex-wrap justify-center gap-4 mb-8">
                          {prediction.map((num, i) => (
                            <div key={i} className="w-16 h-16 sm:w-20 sm:h-20 rounded-full border-4 border-slate-100 flex items-center justify-center text-2xl sm:text-3xl font-black text-slate-800 bg-white shadow-xl animate-bounce" style={{ animationDelay: `${i * 0.1}s` }}>{num}</div>
                          ))}
                        </div>
                        <button onClick={generatePrediction} className="flex items-center gap-2 bg-slate-900 text-white px-8 py-4 rounded-full font-bold text-lg hover:bg-slate-800 transition-all active:scale-95 shadow-lg">
                          <Icon name="RefreshCcw" size={20} /> Generate Next Combination
                        </button>
                        <div className="mt-8 p-4 bg-slate-50 rounded-xl border border-slate-200 max-w-md">
                            <p className="text-slate-400 text-[10px] text-center italic leading-relaxed">
                                <strong>DISCLAIMER:</strong> Probability-based tool only. Play responsibly.
                            </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {activeTab === 'history' && (
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                      <div className="overflow-x-auto">
                        <table className="w-full text-left border-collapse min-w-[600px]">
                          <thead>
                            <tr className="bg-slate-50 border-b">
                              <th className="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Draw Date</th>
                              <th className="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Combination</th>
                              <th className="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Jackpot Prize</th>
                            </tr>
                          </thead>
                          <tbody>
                            {lottoData.filter(h => h.game.includes(selectedGame)).slice(0, 50).map((draw, idx) => (
                              <tr key={idx} className="border-b hover:bg-slate-50 transition-colors">
                                <td className="px-6 py-4 text-sm font-medium text-slate-700">{draw.date}</td>
                                <td className="px-6 py-4">
                                  <div className="flex gap-1.5 sm:gap-2">
                                    {draw.numbers.map((n, i) => (
                                      <span key={i} className="w-7 h-7 sm:w-8 sm:h-8 rounded-full border border-slate-200 bg-white flex items-center justify-center text-[10px] sm:text-xs font-bold text-slate-700">{n}</span>
                                    ))}
                                  </div>
                                </td>
                                <td className="px-6 py-4"><span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-[10px] font-bold bg-green-100 text-green-800">{draw.jackpot}</span></td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  )}
                </div>
              </main>

              <footer className="mt-12 border-t bg-white py-8">
                <div className="max-w-5xl mx-auto px-4 text-center">
                  <button onClick={fetchData} className="text-xs text-blue-600 font-bold flex items-center gap-1 mx-auto mb-4 hover:underline">
                      <Icon name="RefreshCcw" size={12} /> Sync Latest Records
                  </button>
                  <p className="text-slate-500 text-[10px] mb-2 font-medium">Data sourced from community-maintained records. Use for analysis only.</p>
                </div>
              </footer>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
